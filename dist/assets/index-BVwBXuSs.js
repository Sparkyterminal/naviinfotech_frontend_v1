import{a as r,u as w,_ as g,s as S,b as U,c as b,d as T,P as V,L as j,e as q,f as D}from"./index-DhGHWYZ-.js";function F(){var e=r.useRef(!1);return w(function(){return e.current=!0,function(){e.current=!1}},[]),e}function H(){var e=F(),a=g(r.useState(0),2),u=a[0],i=a[1],o=r.useCallback(function(){e.current&&i(u+1)},[u]),p=r.useCallback(function(){return S.postRender(o)},[o]);return[p,u]}var M=function(e){var a=e.children,u=e.initial,i=e.isPresent,o=e.onExitComplete,p=e.custom,h=e.presenceAffectsLayout,s=U(J),E=b(),R=r.useMemo(function(){return{id:E,initial:u,isPresent:i,custom:p,onExitComplete:function(l){var d,C;s.set(l,!0);try{for(var c=T(s.values()),n=c.next();!n.done;n=c.next()){var f=n.value;if(!f)return}}catch(v){d={error:v}}finally{try{n&&!n.done&&(C=c.return)&&C.call(c)}finally{if(d)throw d.error}}o?.()},register:function(l){return s.set(l,!1),function(){return s.delete(l)}}}},h?void 0:[i]);return r.useMemo(function(){s.forEach(function(l,d){return s.set(d,!1)})},[i]),r.useEffect(function(){!i&&!s.size&&o?.()},[i]),r.createElement(V.Provider,{value:R},a)};function J(){return new Map}var m=function(e){return e.key||""};function N(e,a){e.forEach(function(u){var i=m(u);a.set(i,u)})}function Q(e){var a=[];return r.Children.forEach(e,function(u){r.isValidElement(u)&&a.push(u)}),a}var X=function(e){var a=e.children,u=e.custom,i=e.initial,o=i===void 0?!0:i,p=e.onExitComplete,h=e.exitBeforeEnter,s=e.presenceAffectsLayout,E=s===void 0?!0:s,R=g(H(),1),l=R[0],d=r.useContext(j).forceRender;d&&(l=d);var C=F(),c=Q(a),n=c,f=new Set,v=r.useRef(n),y=r.useRef(new Map).current,L=r.useRef(!0);if(w(function(){L.current=!1,N(c,y),v.current=n}),q(function(){L.current=!0,y.clear(),f.clear()}),L.current)return r.createElement(r.Fragment,null,n.map(function(t){return r.createElement(M,{key:m(t),isPresent:!0,initial:o?void 0:!1,presenceAffectsLayout:E},t)}));n=D([],g(n),!1);for(var P=v.current.map(m),I=c.map(m),z=P.length,A=0;A<z;A++){var k=P[A];I.indexOf(k)===-1&&f.add(k)}return h&&f.size&&(n=[]),f.forEach(function(t){if(I.indexOf(t)===-1){var x=y.get(t);if(x){var K=P.indexOf(t),O=function(){y.delete(t),f.delete(t);var B=v.current.findIndex(function(G){return G.key===t});if(v.current.splice(B,1),!f.size){if(v.current=c,C.current===!1)return;l(),p&&p()}};n.splice(K,0,r.createElement(M,{key:m(x),isPresent:!1,onExitComplete:O,custom:u,presenceAffectsLayout:E},x))}}}),n=n.map(function(t){var x=t.key;return f.has(x)?t:r.createElement(M,{key:m(t),isPresent:!0,presenceAffectsLayout:E},t)}),r.createElement(r.Fragment,null,f.size?n:n.map(function(t){return r.cloneElement(t)}))};export{X as A};
